<!-- 
  Componente: Textarea con Validación
  Archivo: form-textarea.html
  
  Componente para campos de texto multilínea con validación.
-->

{# 
  Uso:
  {% include 'components/form-textarea.html' with {
    'name': 'mensaje',
    'label': 'Mensaje',
    'placeholder': 'Escribe tu mensaje aquí...',
    'validation': 'required|minLength:10',
    'required': true,
    'rows': 4
  } %}
#}

{% set field_id = name %}
{% set field_label = label %}
{% set field_placeholder = placeholder or '' %}
{% set field_validation = validation or '' %}
{% set field_required = required or false %}
{% set field_value = value or '' %}
{% set field_rows = rows or 4 %}
{% set field_class = class or 'form-input' %}
{% set field_minlength = minlength or '' %}
{% set field_maxlength = maxlength or '' %}

<div class="form-group">
    <label for="{{ field_id }}" class="form-label">
        {{ field_label }}
        {% if field_required %}
            <span class="required-asterisk">*</span>
        {% endif %}
    </label>
    
    <div class="form-field">
        <textarea 
            id="{{ field_id }}"
            name="{{ field_id }}"
            class="{{ field_class }}"
            placeholder="{{ field_placeholder }}"
            rows="{{ field_rows }}"
            {% if field_validation %}data-validate="{{ field_validation }}"{% endif %}
            {% if field_required %}required{% endif %}
            {% if field_minlength %}minlength="{{ field_minlength }}"{% endif %}
            {% if field_maxlength %}maxlength="{{ field_maxlength }}"{% endif %}
            aria-describedby="{{ field_id }}_error"
        >{{ field_value }}</textarea>
        
        {% if field_maxlength %}
            <div class="character-count">
                <span id="{{ field_id }}_count">0</span>/{{ field_maxlength }}
            </div>
        {% endif %}
    </div>
</div>

{% if field_maxlength %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const textarea = document.getElementById('{{ field_id }}');
    const counter = document.getElementById('{{ field_id }}_count');
    const maxLength = {{ field_maxlength }};
    
    function updateCounter() {
        const currentLength = textarea.value.length;
        counter.textContent = currentLength;
        counter.parentElement.classList.toggle('character-count-warning', currentLength > maxLength * 0.8);
        counter.parentElement.classList.toggle('character-count-error', currentLength >= maxLength);
    }
    
    textarea.addEventListener('input', updateCounter);
    updateCounter(); // Inicializar
});
</script>
{% endif %}