{% extends "layouts/base.html" %}

{% block title %}Iniciar Sesión - Adopt Me{% endblock %}

{% set page_class = "login-page" %}

{% block background_effects %}
{% include 'components/particles.html' %}
{% include 'components/paws.html' %}
{% endblock %}

{% block navbar %}
<!-- No navbar en login -->
{% endblock %}

{% block footer %}
<!-- No footer en login -->
{% endblock %}

{% block content %}
<div class="login-container">
    <div class="login-card">
        {% include 'components/university_logo.html' %}

            <h1 class="login-title">Iniciar Sesión</h1>

            <form id="loginForm" method="POST" action="{{ url_for('Iniciar_Sesion') }}" data-validate novalidate>
                
                {% include 'components/form-field.html' with {
                    'name': 'email',
                    'type': 'email',
                    'label': 'Correo Electrónico',
                    'placeholder': 'ejemplo@correo.com',
                    'validation': 'required|email',
                    'icon': 'fa-envelope',
                    'required': true,
                    'autocomplete': 'email'
                } %}

                {% include 'components/form-field.html' with {
                    'name': 'password',
                    'type': 'password',
                    'label': 'Contraseña',
                    'placeholder': 'Ingresa tu contraseña',
                    'validation': 'required',
                    'icon': 'fa-lock',
                    'required': true,
                    'autocomplete': 'current-password'
                } %}

                <button type="submit" class="login-btn submit-btn" disabled>
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Iniciar Sesión</span>
                </button>
            </form>

            <div class="register-link">
                <a href="/registro">¿No tienes cuenta? Crear cuenta</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block stylesheets %}
<link href="{{ url_for('static', filename='css/registro-usuario.css') }}" rel="stylesheet" />
<link href="{{ url_for('static', filename='css/validation.css') }}" rel="stylesheet" />
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='JS/validation.js') }}"></script>
<script>
(function () {
    const form = document.getElementById('loginForm');
    const inputs = form.querySelectorAll('.form-input');
    const submitBtn = document.getElementById('submitBtn');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const btnText = document.getElementById('btnText');

    // Efectos de focus para los iconos
    inputs.forEach(input => {
        input.addEventListener('focus', () => {
            const icon = input.nextElementSibling;
            if (icon && icon.classList.contains('input-icon')) {
                icon.style.color = '#e08c2b';
            }
        });

        input.addEventListener('blur', () => {
            const icon = input.nextElementSibling;
            if (icon && icon.classList.contains('input-icon') && !input.value) {
                icon.style.color = '#eeb807';
            }
        });
    });

    // Submit del formulario
    form.addEventListener('submit', function (e) {
        e.preventDefault();

        // Validar que ambos campos tengan contenido
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();

        if (!email || !password) {
            alert('Por favor, completa todos los campos');
            return;
        }

        // Mostrar loading
        submitBtn.disabled = true;
        loadingSpinner.style.display = 'inline-block';
        btnText.textContent = 'Iniciando sesión...';

        // Simular proceso de login y redirigir a la página principal
        setTimeout(() => {
            window.location.href = '/';
        }, 1500);
    });

    // Efecto de escritura en el título
    const title = document.querySelector('.login-title');
    const titleText = title.textContent;
    title.textContent = '';

    setTimeout(() => {
        let i = 0;
        const typeWriter = () => {
            if (i < titleText.length) {
                title.textContent += titleText.charAt(i);
                i++;
                setTimeout(typeWriter, 100);
            }
        };
        typeWriter();
    }, 800);
})();
</script>
{% endblock %}